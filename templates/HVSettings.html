<!DOCTYPE html>
<html lang="en">
    
    <head>
        <title>HVPSU</title>
        <link rel="stylesheet" href="static\css\HVStyleSheet.css"/>
        <link rel = "icon" href ="static\img\icon.ico" type="image/icon"/>
    </head>

    <div>
        {% with messages = get_flashed_messages() %}
         {% if messages %}
            <ul>
               {% for message in messages %}
               <li>{{ message }}</li>
               {% endfor %}
            </ul>
         {% endif %}
      {% endwith %}
    </div>
    
    <header>
        <h1>High Voltage Supply Configuration</h1>
    </header>

    

    <script> 
        function onlyNumberKey(evt) { 
              
            // Only ASCII charactar in that range allowed NUMBERS AND .
            var ASCIICode = (evt.which) ? evt.which : evt.keyCode 
            if (ASCIICode > 31 && (ASCIICode < 48 || ASCIICode > 57) && ASCIICode != 46)
                return false; 
            return true; 
        } 
        var grayout = '{{grayOut}}';
        function grayerOuter(){    
                   
            if (grayout == "True"){
                alert("Certain Elements are blocked because a conditioning routine is in progress");
                var elm =  document.getElementsByClassName("grayable")
                for (var i = 0; i < elm.length; i++) { 
                    elm[i].disabled = true;
            }}
            else{
                for (var i = 0; i < elm.length; i++) { 
                elm[i].disabled = false;
            }
            }
            
        }
        function runInterval(){
            if (grayout == "True"){
            setInterval(loadKVMA,1000)
            }
        }

        function loadKVMA() {
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function () {
                    if (this.readyState == 4 && this.status == 200) {
                        document.getElementById("displayKVMA").innerHTML = this.responseText;
                    }
                };
                xhttp.open("GET", "/kvmaUpdate", true);
                xhttp.send();
            }
        
    </script>

    <h1><a href="Quick_Access"><button class="b1">Return to Quick Access</button></a></h1>
    <body  onload='grayerOuter(); runInterval()'>
    <article>
        <section >
            <h1>Power Supply 1 Settings</h1>
            <p ID="displayKVMA"></p>
            <br>
            <div class="variables">
            <form action="/updateHV" method="POST">
                <label>Filament Current Limit:</label>
                <input class="grayable" type="text" onkeypress="return onlyNumberKey(event)" placeholder="Filament Current Limit" name="filCurLim" value={{filCurLim}}>
                <br>
                <label>Filament Pre-Heat:</label>
                <input class="grayable" type="text" onkeypress="return onlyNumberKey(event)" placeholder="Filament Pre-Heat" name="filPreHeat" value={{filPreHeat}}>
                <br>
                <label>Max Allowed Supply KV:</label>
                <input class="grayable" type="text" onkeypress="return onlyNumberKey(event)" placeholder="Max Allowed KV" name="maxKV" value={{maxKV}} disabled>
                <br>
                <label>Max Allowed Supply MA:</label>
                <input class="grayable"type="text" onkeypress="return onlyNumberKey(event)" placeholder="Max Allowed MA" name="maxMA" value={{maxMA}} disabled>
                <br>
                <label>Max Allowed Tube KV:</label>
                <input class="grayable" type="text" onkeypress="return onlyNumberKey(event)" placeholder="Max Allowed Tube KV" name="maxTubeKV" value={{maxTubeKV}} disabled>
                <br>
                <label>Max Allowed Tube MA:</label>
                <input class="grayable" type="text" onkeypress="return onlyNumberKey(event)" placeholder="Max Allowed Tube MA" name="maxTubeMA" value={{maxTubeMA}} disabled>
                <br>
                <label>kV Starting Voltage:</label>
                <input class="grayable" type="text" onkeypress="return onlyNumberKey(event)" placeholder="kV Starting Voltage" name="condKVStart" value={{condKVStart}}>
                <br>
                <label>kV Target Voltage:</label>
                <input class="grayable" type="text" onkeypress="return onlyNumberKey(event)" placeholder="kV Target Voltage" name="condKVTarget" value={{condKVTarget}}>
                <br>
                <label>mA Starting Current:</label>
                <input class="grayable" type="text" onkeypress="return onlyNumberKey(event)" placeholder="mA Starting Current" name="condMAStart" value={{condMAStart}}>
                <br>
                <label>mA Target Current:</label>
                <input class="grayable" type="text" onkeypress="return onlyNumberKey(event)" placeholder="mA Target Current" name="condMATarget" value={{condMATarget}}>
                <br>
                <label>Conditioning Step Dwell:</label>
                <input class="grayable" type="text" onkeypress="return onlyNumberKey(event)" placeholder="Conditioning Step Dwell" name="condStepDwell" value={{condStepDwell}}>
                <br>
                <label>Dwell Time at Max:</label>
                <input class="grayable" type="text" onkeypress="return onlyNumberKey(event)" placeholder="Dwell Time at Max" name="condAtMaxDwell" value={{condAtMaxDwell}}>
                <br>
                <label>Post Arc Dwell:</label>
                <input class="grayable" type="text" onkeypress="return onlyNumberKey(event)" placeholder="Post Arc Dwell" name="condPostArcDwell" value={{condPostArcDwell}}>
                <br>
                <label>Off Dwell:</label>
                <input class="grayable" type="text" onkeypress="return onlyNumberKey(event)" placeholder="Off Dwell" name="condOffDwell" value={{condOffDwell}}>
                <br>
                <label>Number of Steps:</label>
                <input class="grayable" type="text" onkeypress="return onlyNumberKey(event)" placeholder="Number of Steps" name="condStepCount" value={{condStepCount}}>
                <br>
                <input class="grayable"  type="submit" name="UpdatePSU1" value="Click to Update Params" >
            </form>
            </div>
            <div class="Conditioning">
            <form action="/SCond" method="POST">
                <br>
                <input class="grayable" type="submit" name="StartCond" value="Click to Start Conditioning" >
                <input type="submit" name="StopCond" value="Click to Stop Conditioning" >
            </form>
            </div>

            <br>
            <!-- <form action="/updateHV" method="GET">
                <label>Total Time</label>
                <br>
                <label value="this is a test"></label>
                <br>
                <label>Total Time Remaining</label>
                <br>
                <label value="this is a test"></label>

                <input type="button" name="update_time" value="Calculate Time">
            </form> -->
        </section>
</article>
</html>